/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{478:function(Aa,wa,r){r.r(wa);var oa=r(0),na=r(8),ma=r(2);Aa=r(48);var fa=r(23),da=r(11);r=function(){function aa(){this.init()}aa.prototype.init=function(){this.b$=!1;this.cf=this.Rl=this.connection=null;this.Is={};this.fa=this.vG=null};aa.prototype.ara=function(y){for(var w=this,f=0;f<y.length;++f){var e=y[f];switch(e.at){case "create":this.Is[e.author]||(this.Is[e.author]=e.aName);this.kha(e);break;case "modify":this.fa.Cm(e.xfdf).then(function(a){w.fa.gb(a[0])});
break;case "delete":this.fa.Cm("<delete><id>"+e.aId+"</id></delete>")}}};aa.prototype.kha=function(y){var w=this;this.fa.Cm(y.xfdf).then(function(f){f=f[0];f.authorId=y.author;w.fa.gb(f);w.fa.trigger(na.c.UPDATE_ANNOTATION_PERMISSION,[f])})};aa.prototype.Mga=function(y,w,f){this.Rl&&this.Rl(y,w,f)};aa.prototype.preloadAnnotations=function(y){this.addEventListener("webViewerServerAnnotationsEnabled",this.Mga.bind(this,y,"add",{imported:!1}),{once:!0})};aa.prototype.initiateCollaboration=function(y,
w,f){var e=this;if(y){e.cf=w;e.fa=f.ma();f.addEventListener(na.f.DOCUMENT_UNLOADED,function(){e.disableCollaboration()});e.Cra(y);var a=new XMLHttpRequest;a.addEventListener("load",function(){if(200===a.status&&0<a.responseText.length)try{var b=JSON.parse(a.responseText);e.connection=exports.Ua.Osa(Object(fa.k)(e.cf,"blackbox/"),"annot");e.vG=b.id;e.Is[b.id]=b.user_name;e.fa.UN(b.id);e.connection.Ova(function(h){h.t&&h.t.startsWith("a_")&&h.data&&e.ara(h.data)},function(){e.connection.send({t:"a_retrieve",
dId:y});e.trigger(aa.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[e.Is[b.id],e.vG])},function(){e.disableCollaboration()})}catch(h){Object(ma.g)(h.message)}});a.open("GET",Object(fa.k)(this.cf,"demo/SessionInfo.jsp"));a.withCredentials=!0;a.send();e.b$=!0;e.fa.i0(function(b){return e.Is[b.Author]||b.Author})}else Object(ma.g)("Document ID required for collaboration")};aa.prototype.disableCollaboration=function(){this.Rl&&(this.fa.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.Rl),this.Rl=
null);this.connection&&this.connection.rq();this.fa&&this.fa.UN("Guest");this.init();this.trigger(aa.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};aa.prototype.Cra=function(y){var w=this;this.Rl&&this.fa.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.Rl);this.Rl=function(f,e,a){return Object(oa.b)(this,void 0,void 0,function(){var b,h,n,z,x,ca,ja,ba,ea;return Object(oa.d)(this,function(ia){switch(ia.label){case 0:if(a.imported)return[2];b={t:"a_"+e,dId:y,annots:[]};return[4,w.fa.RJ()];case 1:h=
ia.ca();"delete"!==e&&(n=(new DOMParser).parseFromString(h,"text/xml"),z=new XMLSerializer);for(x=0;x<f.length;x++)ca=f[x],ba=ja=void 0,"add"===e?(ja=n.querySelector('[name="'+ca.Id+'"]'),ba=z.serializeToString(ja),ea=null,ca.InReplyTo&&(ea=w.fa.wf(ca.InReplyTo).authorId||"default"),b.annots.push({at:"create",aId:ca.Id,author:w.vG,aName:w.Is[w.vG],parent:ea,xfdf:"<add>"+ba+"</add>"})):"modify"===e?(ja=n.querySelector('[name="'+ca.Id+'"]'),ba=z.serializeToString(ja),b.annots.push({at:"modify",aId:ca.Id,
xfdf:"<modify>"+ba+"</modify>"})):"delete"===e&&b.annots.push({at:"delete",aId:ca.Id});0<b.annots.length&&w.connection.send(b);return[2]}})})}.bind(w);this.fa.addEventListener(da.a.Events.ANNOTATION_CHANGED,this.Rl)};aa.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return aa}();Object(Aa.a)(r);wa["default"]=r}}]);}).call(this || window)
